"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5254],{61411:function(Ce,oe,j){j.d(oe,{y:function(){return fn}});var h=j(99477);var J={},Y=function(i){return URL.createObjectURL(new Blob([i],{type:"text/javascript"}))},ae=function(i){return new Worker(i)};try{URL.revokeObjectURL(Y(""))}catch(i){Y=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},ae=function(e){return new Worker(e,{type:"module"})}}var I=function(i,e,t,n,r){var a=ae(J[e]||(J[e]=Y(i)));return a.onerror=function(s){return r(s.error,null)},a.onmessage=function(s){return r(null,s.data)},a.postMessage(t,n),a},w=Uint8Array,b=Uint16Array,P=Uint32Array,g=new w([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),C=new w([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),B=new w([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V=function(i,e){for(var t=new b(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var r=new P(t[30]),n=1;n<30;++n)for(var a=t[n];a<t[n+1];++a)r[a]=a-t[n]<<5|n;return[t,r]},R=V(g,2),L=R[0],le=R[1];L[28]=258,le[258]=28;for(var _e=V(C,0),ft=_e[0],Ye=_e[1],ke=new b(32768),z=0;z<32768;++z){var de=(z&43690)>>>1|(z&21845)<<1;de=(de&52428)>>>2|(de&13107)<<2,de=(de&61680)>>>4|(de&3855)<<4,ke[z]=((de&65280)>>>8|(de&255)<<8)>>>1}for(var he=function(i,e,t){for(var n=i.length,r=0,a=new b(e);r<n;++r)++a[i[r]-1];var s=new b(e);for(r=0;r<e;++r)s[r]=s[r-1]+a[r-1]<<1;var o;if(t){o=new b(1<<e);var l=15-e;for(r=0;r<n;++r)if(i[r])for(var f=r<<4|i[r],u=e-i[r],c=s[i[r]-1]++<<u,p=c|(1<<u)-1;c<=p;++c)o[ke[c]>>>l]=f}else for(o=new b(n),r=0;r<n;++r)i[r]&&(o[r]=ke[s[i[r]-1]++]>>>15-i[r]);return o},me=new w(288),z=0;z<144;++z)me[z]=8;for(var z=144;z<256;++z)me[z]=9;for(var z=256;z<280;++z)me[z]=7;for(var z=280;z<288;++z)me[z]=8;for(var Ae=new w(32),z=0;z<32;++z)Ae[z]=5;var ut=null,ht=he(me,9,1),pt=null,vt=he(Ae,5,1),Fe=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},se=function(i,e,t){var n=e/8|0;return(i[n]|i[n+1]<<8)>>(e&7)&t},Re=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},Se=function(i){return(i/8|0)+(i&7&&1)},ge=function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var n=new(i instanceof b?b:i instanceof P?P:w)(t-e);return n.set(i.subarray(e,t)),n},ze=function(i,e,t){var n=i.length;if(!n||t&&!t.l&&n<5)return e||new w(0);var r=!e||t,a=!t||t.i;t||(t={}),e||(e=new w(n*3));var s=function(Ne){var Ee=e.length;if(Ne>Ee){var be=new w(Math.max(Ee*2,Ne));be.set(e),e=be}},o=t.f||0,l=t.p||0,f=t.b||0,u=t.l,c=t.d,p=t.m,v=t.n,d=n*8;do{if(!u){t.f=o=se(i,l,1);var m=se(i,l+1,3);if(l+=3,m)if(m==1)u=ht,c=vt,p=9,v=5;else if(m==2){var y=se(i,l,31)+257,k=se(i,l+10,15)+4,E=y+se(i,l+5,31)+1;l+=14;for(var S=new w(E),A=new w(19),D=0;D<k;++D)A[B[D]]=se(i,l+D*3,7);l+=k*3;for(var H=Fe(A),F=(1<<H)-1,ee=he(A,H,1),D=0;D<E;){var U=ee[se(i,l,F)];l+=U&15;var x=U>>>4;if(x<16)S[D++]=x;else{var K=0,Z=0;for(x==16?(Z=3+se(i,l,3),l+=2,K=S[D-1]):x==17?(Z=3+se(i,l,7),l+=3):x==18&&(Z=11+se(i,l,127),l+=7);Z--;)S[D++]=K}}var Q=S.subarray(0,y),G=S.subarray(y);p=Fe(Q),v=Fe(G),u=he(Q,p,1),c=he(G,v,1)}else throw"invalid block type";else{var x=Se(l)+4,_=i[x-4]|i[x-3]<<8,T=x+_;if(T>n){if(a)throw"unexpected EOF";break}r&&s(f+_),e.set(i.subarray(x,T),f),t.b=f+=_,t.p=l=T*8;continue}if(l>d){if(a)throw"unexpected EOF";break}}r&&s(f+131072);for(var W=(1<<p)-1,te=(1<<v)-1,ie=l;;ie=l){var K=u[Re(i,l)&W],fe=K>>>4;if(l+=K&15,l>d){if(a)throw"unexpected EOF";break}if(!K)throw"invalid length/literal";if(fe<256)e[f++]=fe;else if(fe==256){ie=l,u=null;break}else{var ne=fe-254;if(fe>264){var D=fe-257,ue=g[D];ne=se(i,l,(1<<ue)-1)+L[D],l+=ue}var ve=c[Re(i,l)&te],re=ve>>>4;if(!ve)throw"invalid distance";l+=ve&15;var G=ft[re];if(re>3){var ue=C[re];G+=Re(i,l)&(1<<ue)-1,l+=ue}if(l>d){if(a)throw"unexpected EOF";break}r&&s(f+131072);for(var $=f+ne;f<$;f+=4)e[f]=e[f-G],e[f+1]=e[f+1-G],e[f+2]=e[f+2-G],e[f+3]=e[f+3-G];f=$}}t.l=u,t.p=ie,t.b=f,u&&(o=1,t.m=p,t.d=c,t.n=v)}while(!o);return f==e.length?e:ge(e,0,f)},pe=function(i,e,t){t<<=e&7;var n=e/8|0;i[n]|=t,i[n+1]|=t>>>8},we=function(i,e,t){t<<=e&7;var n=e/8|0;i[n]|=t,i[n+1]|=t>>>8,i[n+2]|=t>>>16},Le=function(i,e){for(var t=[],n=0;n<i.length;++n)i[n]&&t.push({s:n,f:i[n]});var r=t.length,a=t.slice();if(!r)return[Be,0];if(r==1){var s=new w(t[0].s+1);return s[t[0].s]=1,[s,1]}t.sort(function(E,S){return E.f-S.f}),t.push({s:-1,f:25001});var o=t[0],l=t[1],f=0,u=1,c=2;for(t[0]={s:-1,f:o.f+l.f,l:o,r:l};u!=r-1;)o=t[t[f].f<t[c].f?f++:c++],l=t[f!=u&&t[f].f<t[c].f?f++:c++],t[u++]={s:-1,f:o.f+l.f,l:o,r:l};for(var p=a[0].s,n=1;n<r;++n)a[n].s>p&&(p=a[n].s);var v=new b(p+1),d=Ue(t[u-1],v,0);if(d>e){var n=0,m=0,x=d-e,_=1<<x;for(a.sort(function(S,A){return v[A.s]-v[S.s]||S.f-A.f});n<r;++n){var T=a[n].s;if(v[T]>e)m+=_-(1<<d-v[T]),v[T]=e;else break}for(m>>>=x;m>0;){var y=a[n].s;v[y]<e?m-=1<<e-v[y]++-1:++n}for(;n>=0&&m;--n){var k=a[n].s;v[k]==e&&(--v[k],++m)}d=e}return[new w(v),d]},Ue=function(i,e,t){return i.s==-1?Math.max(Ue(i.l,e,t+1),Ue(i.r,e,t+1)):e[i.s]=t},$e=function(i){for(var e=i.length;e&&!i[--e];);for(var t=new b(++e),n=0,r=i[0],a=1,s=function(l){t[n++]=l},o=1;o<=e;++o)if(i[o]==r&&o!=e)++a;else{if(!r&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(r),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(r);a=1,r=i[o]}return[t.subarray(0,n),e]},xe=function(i,e){for(var t=0,n=0;n<e.length;++n)t+=i[n]*e[n];return t},Ie=function(i,e,t){var n=t.length,r=Se(e+2);i[r]=n&255,i[r+1]=n>>>8,i[r+2]=i[r]^255,i[r+3]=i[r+1]^255;for(var a=0;a<n;++a)i[r+a+4]=t[a];return(r+4+n)*8},Je=function(i,e,t,n,r,a,s,o,l,f,u){pe(e,u++,t),++r[256];for(var c=Le(r,15),p=c[0],v=c[1],d=Le(a,15),m=d[0],x=d[1],_=$e(p),T=_[0],y=_[1],k=$e(m),E=k[0],S=k[1],A=new b(19),D=0;D<T.length;++D)A[T[D]&31]++;for(var D=0;D<E.length;++D)A[E[D]&31]++;for(var H=Le(A,7),F=H[0],ee=H[1],U=19;U>4&&!F[B[U-1]];--U);var K=f+5<<3,Z=xe(r,me)+xe(a,Ae)+s,Q=xe(r,p)+xe(a,m)+s+14+3*U+xe(A,F)+(2*A[16]+3*A[17]+7*A[18]);if(K<=Z&&K<=Q)return Ie(e,u,i.subarray(l,l+f));var G,W,te,ie;if(pe(e,u,1+(Q<Z)),u+=2,Q<Z){G=he(p,v,0),W=p,te=he(m,x,0),ie=m;var fe=he(F,ee,0);pe(e,u,y-257),pe(e,u+5,S-1),pe(e,u+10,U-4),u+=14;for(var D=0;D<U;++D)pe(e,u+3*D,F[B[D]]);u+=3*U;for(var ne=[T,E],ue=0;ue<2;++ue)for(var ve=ne[ue],D=0;D<ve.length;++D){var re=ve[D]&31;pe(e,u,fe[re]),u+=F[re],re>15&&(pe(e,u,ve[D]>>>5&127),u+=ve[D]>>>12)}}else G=ut,W=me,te=pt,ie=Ae;for(var D=0;D<o;++D)if(n[D]>255){var re=n[D]>>>18&31;we(e,u,G[re+257]),u+=W[re+257],re>7&&(pe(e,u,n[D]>>>23&31),u+=g[re]);var $=n[D]&31;we(e,u,te[$]),u+=ie[$],$>3&&(we(e,u,n[D]>>>5&8191),u+=C[$])}else we(e,u,G[n[D]]),u+=W[n[D]];return we(e,u,G[256]),u+W[256]},dt=new P([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Be=new w(0),mt=function(i,e,t,n,r,a){var s=i.length,o=new w(n+s+5*(1+Math.ceil(s/7e3))+r),l=o.subarray(n,o.length-r),f=0;if(!e||s<8)for(var u=0;u<=s;u+=65535){var c=u+65535;c<s?f=Ie(l,f,i.subarray(u,c)):(l[u]=a,f=Ie(l,f,i.subarray(u,s)))}else{for(var p=dt[e-1],v=p>>>13,d=p&8191,m=(1<<t)-1,x=new b(32768),_=new b(m+1),T=Math.ceil(t/3),y=2*T,k=function(ct){return(i[ct]^i[ct+1]<<T^i[ct+2]<<y)&m},E=new P(25e3),S=new b(288),A=new b(32),D=0,H=0,u=0,F=0,ee=0,U=0;u<s;++u){var K=k(u),Z=u&32767,Q=_[K];if(x[Z]=Q,_[K]=Z,ee<=u){var G=s-u;if((D>7e3||F>24576)&&G>423){f=Je(i,l,0,E,S,A,H,F,U,u-U,f),F=D=H=0,U=u;for(var W=0;W<286;++W)S[W]=0;for(var W=0;W<30;++W)A[W]=0}var te=2,ie=0,fe=d,ne=Z-Q&32767;if(G>2&&K==k(u-ne))for(var ue=Math.min(v,G)-1,ve=Math.min(32767,u),re=Math.min(258,G);ne<=ve&&--fe&&Z!=Q;){if(i[u+te]==i[u+te-ne]){for(var $=0;$<re&&i[u+$]==i[u+$-ne];++$);if($>te){if(te=$,ie=ne,$>ue)break;for(var Ne=Math.min(ne,$-2),Ee=0,W=0;W<Ne;++W){var be=u-ne+W+32768&32767,Tn=x[be],Vt=be-Tn+32768&32767;Vt>Ee&&(Ee=Vt,Q=be)}}}Z=Q,Q=x[Z],ne+=Z-Q+32768&32767}if(ie){E[F++]=268435456|le[te]<<18|Ye[ie];var Zt=le[te]&31,jt=Ye[ie]&31;H+=g[Zt]+C[jt],++S[257+Zt],++A[jt],ee=u+te,++D}else E[F++]=i[u],++S[i[u]]}}f=Je(i,l,a,E,S,A,H,F,U,u-U,f),!a&&f&7&&(f=Ie(l,f+1,Be))}return ge(o,0,n+Se(f)+r)},gt=null,Oe=function(){var i=-1;return{p:function(e){for(var t=i,n=0;n<e.length;++n)t=gt[t&255^e[n]]^t>>>8;i=t},d:function(){return~i}}},yt=function(){var i=1,e=0;return{p:function(t){for(var n=i,r=e,a=t.length,s=0;s!=a;){for(var o=Math.min(s+2655,a);s<o;++s)r+=n+=t[s];n=(n&65535)+15*(n>>16),r=(r&65535)+15*(r>>16)}i=n,e=r},d:function(){return i%=65521,e%=65521,(i&255)<<24|i>>>8<<16|(e&255)<<8|e>>>8}}},Ge=function(i,e,t,n,r){return mt(i,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):12+e.mem,t,n,!r)},Ve=function(i,e){var t={};for(var n in i)t[n]=i[n];for(var n in e)t[n]=e[n];return t},wt=function(i,e,t){for(var n=i(),r=i.toString(),a=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),s=0;s<n.length;++s){var o=n[s],l=a[s];if(typeof o=="function"){e+=";"+l+"=";var f=o.toString();if(o.prototype)if(f.indexOf("[native code]")!=-1){var u=f.indexOf(" ",8)+1;e+=f.slice(u,f.indexOf("(",u))}else{e+=f;for(var c in o.prototype)e+=";"+l+".prototype."+c+"="+o.prototype[c].toString()}else e+=f}else t[l]=o}return[e,t]},Ze=null,Xt=function(i){var e=[];for(var t in i)(i[t]instanceof w||i[t]instanceof b||i[t]instanceof P)&&e.push((i[t]=new i[t].constructor(i[t])).buffer);return e},xt=function(i,e,t,n){var r;if(!Ze[t]){for(var a="",s={},o=i.length-1,l=0;l<o;++l)r=wt(i[l],a,s),a=r[0],s=r[1];Ze[t]=wt(i[o],a,s)}var f=Ve({},Ze[t][1]);return I(Ze[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,f,Xt(f),n)},qe=function(){return[w,b,P,g,C,B,L,ft,ht,vt,ke,he,Fe,se,Re,Se,ge,ze,Pe,ye,tt]},et=function(){return[w,b,P,g,C,B,le,Ye,ut,me,pt,Ae,ke,dt,Be,he,pe,we,Le,Ue,$e,xe,Ie,Je,Se,ge,mt,Ge,je,ye]},Ht=function(){return[Dt,Ct,O,Oe,gt]},Kt=function(){return[Tt,bt]},Wt=function(){return[_t,O,yt]},Qt=function(){return[kt]},ye=function(i){return postMessage(i,[i.buffer])},tt=function(i){return i&&i.size&&new w(i.size)},De=function(i,e,t,n,r,a){var s=xt(t,n,r,function(o,l){s.terminate(),a(o,l)});return s.postMessage([i,e],e.consume?[i.buffer]:[]),function(){s.terminate()}},bn=function(i){return i.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return i.push(e.data[0],e.data[1])}},Cn=function(i,e,t,n,r){var a,s=xt(i,n,r,function(o,l){o?(s.terminate(),e.ondata.call(e,o)):(l[1]&&s.terminate(),e.ondata.call(e,o,l[0],l[1]))});s.postMessage(t),e.push=function(o,l){if(a)throw"stream finished";if(!e.ondata)throw"no stream handler";s.postMessage([o,a=l],[o.buffer])},e.terminate=function(){s.terminate()}},ce=function(i,e){return i[e]|i[e+1]<<8},N=function(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24)>>>0},nt=function(i,e){return N(i,e)+N(i,e+4)*4294967296},O=function(i,e,t){for(;t;++e)i[e]=t,t>>>=8},Dt=function(i,e){var t=e.filename;if(i[0]=31,i[1]=139,i[2]=8,i[8]=e.level<2?4:e.level==9?2:0,i[9]=3,e.mtime!=0&&O(i,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){i[3]=8;for(var n=0;n<=t.length;++n)i[n+10]=t.charCodeAt(n)}},Tt=function(i){if(i[0]!=31||i[1]!=139||i[2]!=8)throw"invalid gzip data";var e=i[3],t=10;e&4&&(t+=i[10]|(i[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!i[t++]);return t+(e&2)},bt=function(i){var e=i.length;return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0},Ct=function(i){return 10+(i.filename&&i.filename.length+1||0)},_t=function(i,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;i[0]=120,i[1]=n<<6|(n?32-2*n:1)},kt=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function _n(i,e){return!e&&typeof i=="function"&&(e=i,i={}),this.ondata=e,i}var kn=null,An=null;function Nt(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return De(i,e,[et],function(n){return ye(je(n.data[0],n.data[1]))},0,t)}function je(i,e){return Ge(i,e||{},0,0)}var Sn=null,In=null;function At(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return De(i,e,[qe],function(n){return ye(Pe(n.data[0],tt(n.data[1])))},1,t)}function Pe(i,e){return ze(i,e)}var Pn=null,Mn=null;function En(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return De(i,e,[et,Ht,function(){return[St]}],function(n){return ye(St(n.data[0],n.data[1]))},2,t)}function St(i,e){e||(e={});var t=Oe(),n=i.length;t.p(i);var r=Ge(i,e,Ct(e),8),a=r.length;return Dt(r,e),O(r,a-8,t.d()),O(r,a-4,n),r}var Fn=null,Rn=null;function Yt(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return De(i,e,[qe,Kt,function(){return[rt]}],function(n){return ye(rt(n.data[0]))},3,t)}function rt(i,e){return ze(i.subarray(Tt(i),-8),e||new w(bt(i)))}var zn=null,Ln=null;function Un(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return De(i,e,[et,Wt,function(){return[It]}],function(n){return ye(It(n.data[0],n.data[1]))},4,t)}function It(i,e){e||(e={});var t=yt();t.p(i);var n=Ge(i,e,2,4);return _t(n,e),O(n,n.length-4,t.d()),n}var Bn=null,On=null;function $t(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return De(i,e,[qe,Qt,function(){return[Xe]}],function(n){return ye(Xe(n.data[0],tt(n.data[1])))},5,t)}function Xe(i,e){return ze((kt(i),i.subarray(2,-4)),e)}var Gn=null,Vn=null;function Zn(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return i[0]==31&&i[1]==139&&i[2]==8?Yt(i,e,t):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?At(i,e,t):$t(i,e,t)}function jn(i,e){return i[0]==31&&i[1]==139&&i[2]==8?rt(i,e):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?Pe(i,e):Xe(i,e)}var it=function(i,e,t,n){for(var r in i){var a=i[r],s=e+r;a instanceof w?t[s]=[a,n]:Array.isArray(a)?t[s]=[a[0],Ve(n,a[1])]:it(a,s+"/",t,n)}},Pt=typeof TextEncoder!="undefined"&&new TextEncoder,at=typeof TextDecoder!="undefined"&&new TextDecoder,Jt=0;try{at.decode(Be,{stream:!0}),Jt=1}catch(i){}var qt=function(i){for(var e="",t=0;;){var n=i[t++],r=(n>127)+(n>223)+(n>239);if(t+r>i.length)return[e,ge(i,t-1)];r?r==3?(n=((n&15)<<18|(i[t++]&63)<<12|(i[t++]&63)<<6|i[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):r&1?e+=String.fromCharCode((n&31)<<6|i[t++]&63):e+=String.fromCharCode((n&15)<<12|(i[t++]&63)<<6|i[t++]&63):e+=String.fromCharCode(n)}},Xn=null,Hn=null;function He(i,e){if(e){for(var t=new w(i.length),n=0;n<i.length;++n)t[n]=i.charCodeAt(n);return t}if(Pt)return Pt.encode(i);for(var r=i.length,a=new w(i.length+(i.length>>1)),s=0,o=function(u){a[s++]=u},n=0;n<r;++n){if(s+5>a.length){var l=new w(s+8+(r-n<<1));l.set(a),a=l}var f=i.charCodeAt(n);f<128||e?o(f):f<2048?(o(192|f>>6),o(128|f&63)):f>55295&&f<57344?(f=65536+(f&1047552)|i.charCodeAt(++n)&1023,o(240|f>>18),o(128|f>>12&63),o(128|f>>6&63),o(128|f&63)):(o(224|f>>12),o(128|f>>6&63),o(128|f&63))}return ge(a,0,s)}function en(i,e){if(e){for(var t="",n=0;n<i.length;n+=16384)t+=String.fromCharCode.apply(null,i.subarray(n,n+16384));return t}else{if(at)return at.decode(i);var r=qt(i),a=r[0],s=r[1];if(s.length)throw"invalid utf-8 data";return a}}var Kn=function(i){return i==1?3:i<6?2:i==9?1:0},Mt=function(i,e){return e+30+ce(i,e+26)+ce(i,e+28)},Et=function(i,e,t){var n=ce(i,e+28),r=en(i.subarray(e+46,e+46+n),!(ce(i,e+8)&2048)),a=e+46+n,s=N(i,e+20),o=t&&s==4294967295?tn(i,a):[s,N(i,e+24),N(i,e+42)],l=o[0],f=o[1],u=o[2];return[ce(i,e+10),l,f,r,a+ce(i,e+30)+ce(i,e+32),u]},tn=function(i,e){for(;ce(i,e)!=1;e+=4+ce(i,e+2));return[nt(i,e+12),nt(i,e+4),nt(i,e+20)]},Me=function(i){var e=0;if(i)for(var t in i){var n=i[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Ke=function(i,e,t,n,r,a,s,o){var l=n.length,f=t.extra,u=o&&o.length,c=Me(f);O(i,e,s!=null?33639248:67324752),e+=4,s!=null&&(i[e++]=20,i[e++]=t.os),i[e]=20,e+=2,i[e++]=t.flag<<1|(a==null&&8),i[e++]=r&&8,i[e++]=t.compression&255,i[e++]=t.compression>>8;var p=new Date(t.mtime==null?Date.now():t.mtime),v=p.getFullYear()-1980;if(v<0||v>119)throw"date not in range 1980-2099";if(O(i,e,v<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),e+=4,a!=null&&(O(i,e,t.crc),O(i,e+4,a),O(i,e+8,t.size)),O(i,e+12,l),O(i,e+14,c),e+=16,s!=null&&(O(i,e,u),O(i,e+6,t.attrs),O(i,e+10,s),e+=14),i.set(n,e),e+=l,c)for(var d in f){var m=f[d],x=m.length;O(i,e,+d),O(i,e+2,x),i.set(m,e+4),e+=4+x}return u&&(i.set(o,e),e+=u),e},Ft=function(i,e,t,n,r){O(i,e,101010256),O(i,e+8,t),O(i,e+10,t),O(i,e+12,n),O(i,e+16,r)},Wn=null,Qn=null,Nn=null,Yn=null;function $n(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};it(i,"",n,e);var r=Object.keys(n),a=r.length,s=0,o=0,l=a,f=new Array(a),u=[],c=function(){for(var m=0;m<u.length;++m)u[m]()},p=function(){var m=new w(o+22),x=s,_=o-s;o=0;for(var T=0;T<l;++T){var y=f[T];try{var k=y.c.length;Ke(m,o,y,y.f,y.u,k);var E=30+y.f.length+Me(y.extra),S=o+E;m.set(y.c,S),Ke(m,s,y,y.f,y.u,k,o,y.m),s+=16+E+(y.m?y.m.length:0),o=S+k}catch(A){return t(A,null)}}Ft(m,s,f.length,_,x),t(null,m)};a||p();for(var v=function(m){var x=r[m],_=n[x],T=_[0],y=_[1],k=Oe(),E=T.length;k.p(T);var S=He(x),A=S.length,D=y.comment,H=D&&He(D),F=H&&H.length,ee=Me(y.extra),U=y.level==0?0:8,K=function(Z,Q){if(Z)c(),t(Z,null);else{var G=Q.length;f[m]=Ve(y,{size:E,crc:k.d(),c:Q,f:S,m:H,u:A!=x.length||H&&D.length!=F,compression:U}),s+=30+A+ee+G,o+=76+2*(A+ee)+(F||0)+G,--a||p()}};if(A>65535&&K("filename too long",null),!U)K(null,T);else if(E<16e4)try{K(null,je(T,y))}catch(Z){K(Z,null)}else u.push(Nt(T,y,K))},d=0;d<l;++d)v(d);return c}function Jn(i,e){e||(e={});var t={},n=[];it(i,"",t,e);var r=0,a=0;for(var s in t){var o=t[s],l=o[0],f=o[1],u=f.level==0?0:8,c=He(s),p=c.length,v=f.comment,d=v&&He(v),m=d&&d.length,x=Me(f.extra);if(p>65535)throw"filename too long";var _=u?je(l,f):l,T=_.length,y=Oe();y.p(l),n.push(Ve(f,{size:l.length,crc:y.d(),c:_,f:c,m:d,u:p!=s.length||d&&v.length!=m,o:r,compression:u})),r+=30+p+x+T,a+=76+2*(p+x)+(m||0)+T}for(var k=new w(a+22),E=r,S=a-r,A=0;A<n.length;++A){var c=n[A];Ke(k,c.o,c,c.f,c.u,c.c.length);var D=30+c.f.length+Me(c.extra);k.set(c.c,c.o+D),Ke(k,r,c,c.f,c.u,c.c.length,c.o,c.m),r+=16+D+(c.m?c.m.length:0)}return Ft(k,r,n.length,S,E),k}var qn=null,er=null,tr=null,nr=null;function rr(i,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var p=0;p<t.length;++p)t[p]()},r={},a=i.length-22;N(i,a)!=101010256;--a)if(!a||i.length-a>65558){e("invalid zip file",null);return}var s=ce(i,a+8);s||e(null,{});var o=s,l=N(i,a+16),f=l==4294967295;if(f){if(a=N(i,a-12),N(i,a)!=101075792){e("invalid zip file",null);return}o=s=N(i,a+32),l=N(i,a+48)}for(var u=function(p){var v=Et(i,l,f),d=v[0],m=v[1],x=v[2],_=v[3],T=v[4],y=v[5],k=Mt(i,y);l=T;var E=function(A,D){A?(n(),e(A,null)):(r[_]=D,--s||e(null,r))};if(!d)E(null,ge(i,k,k+m));else if(d==8){var S=i.subarray(k,k+m);if(m<32e4)try{E(null,Pe(S,new w(x)))}catch(A){E(A,null)}else t.push(At(S,{size:x},E))}else E("unknown compression type "+d,null)},c=0;c<o;++c)u(c);return n}function ir(i){for(var e={},t=i.length-22;N(i,t)!=101010256;--t)if(!t||i.length-t>65558)throw"invalid zip file";var n=ce(i,t+8);if(!n)return{};var r=N(i,t+16),a=r==4294967295;if(a){if(t=N(i,t-12),N(i,t)!=101075792)throw"invalid zip file";n=N(i,t+32),r=N(i,t+48)}for(var s=0;s<n;++s){var o=Et(i,r,a),l=o[0],f=o[1],u=o[2],c=o[3],p=o[4],v=o[5],d=Mt(i,v);if(r=p,!l)e[c]=ge(i,d,d+f);else if(l==8)e[c]=Pe(i.subarray(d,d+f),new w(u));else throw"unknown compression type "+l}return e}function We(i,e,t){const n=t.length-i-1;if(e>=t[n])return n-1;if(e<=t[i])return i;let r=i,a=n,s=Math.floor((r+a)/2);for(;e<t[s]||e>=t[s+1];)e<t[s]?a=s:r=s,s=Math.floor((r+a)/2);return s}function st(i,e,t,n){const r=[],a=[],s=[];r[0]=1;for(let o=1;o<=t;++o){a[o]=e-n[i+1-o],s[o]=n[i+o]-e;let l=0;for(let f=0;f<o;++f){const u=s[f+1],c=a[o-f],p=r[f]/(u+c);r[f]=l+u*p,l=c*p}r[o]=l}return r}function nn(i,e,t,n){const r=We(i,n,e),a=st(r,n,i,e),s=new h.Vector4(0,0,0,0);for(let o=0;o<=i;++o){const l=t[r-i+o],f=a[o],u=l.w*f;s.x+=l.x*u,s.y+=l.y*u,s.z+=l.z*u,s.w+=l.w*f}return s}function rn(i,e,t,n,r){const a=[];for(let c=0;c<=t;++c)a[c]=0;const s=[];for(let c=0;c<=n;++c)s[c]=a.slice(0);const o=[];for(let c=0;c<=t;++c)o[c]=a.slice(0);o[0][0]=1;const l=a.slice(0),f=a.slice(0);for(let c=1;c<=t;++c){l[c]=e-r[i+1-c],f[c]=r[i+c]-e;let p=0;for(let v=0;v<c;++v){const d=f[v+1],m=l[c-v];o[c][v]=d+m;const x=o[v][c-1]/o[c][v];o[v][c]=p+d*x,p=m*x}o[c][c]=p}for(let c=0;c<=t;++c)s[0][c]=o[c][t];for(let c=0;c<=t;++c){let p=0,v=1;const d=[];for(let m=0;m<=t;++m)d[m]=a.slice(0);d[0][0]=1;for(let m=1;m<=n;++m){let x=0;const _=c-m,T=t-m;c>=m&&(d[v][0]=d[p][0]/o[T+1][_],x=d[v][0]*o[_][T]);const y=_>=-1?1:-_,k=c-1<=T?m-1:t-c;for(let S=y;S<=k;++S)d[v][S]=(d[p][S]-d[p][S-1])/o[T+1][_+S],x+=d[v][S]*o[_+S][T];c<=T&&(d[v][m]=-d[p][m-1]/o[T+1][c],x+=d[v][m]*o[c][T]),s[m][c]=x;const E=p;p=v,v=E}}let u=t;for(let c=1;c<=n;++c){for(let p=0;p<=t;++p)s[c][p]*=u;u*=t-c}return s}function an(i,e,t,n,r){const a=r<i?r:i,s=[],o=We(i,n,e),l=rn(o,n,i,a,e),f=[];for(let u=0;u<t.length;++u){const c=t[u].clone(),p=c.w;c.x*=p,c.y*=p,c.z*=p,f[u]=c}for(let u=0;u<=a;++u){const c=f[o-i].clone().multiplyScalar(l[u][0]);for(let p=1;p<=i;++p)c.add(f[o-i+p].clone().multiplyScalar(l[u][p]));s[u]=c}for(let u=a+1;u<=r+1;++u)s[u]=new h.Vector4(0,0,0);return s}function sn(i,e){let t=1;for(let r=2;r<=i;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=i-e;++r)n*=r;return t/n}function on(i){const e=i.length,t=[],n=[];for(let a=0;a<e;++a){const s=i[a];t[a]=new h.Vector3(s.x,s.y,s.z),n[a]=s.w}const r=[];for(let a=0;a<e;++a){const s=t[a].clone();for(let o=1;o<=a;++o)s.sub(r[a-o].clone().multiplyScalar(sn(a,o)*n[o]));r[a]=s.divideScalar(n[0])}return r}function ln(i,e,t,n,r){const a=an(i,e,t,n,r);return on(a)}function ar(i,e,t,n,r,a,s,o){const l=We(i,a,t),f=We(e,s,n),u=st(l,a,i,t),c=st(f,s,e,n),p=[];for(let d=0;d<=e;++d){p[d]=new Vector4(0,0,0,0);for(let m=0;m<=i;++m){const x=r[l-i+m][f-e+d].clone(),_=x.w;x.x*=_,x.y*=_,x.z*=_,p[d].add(x.multiplyScalar(u[m]))}}const v=new Vector4(0,0,0,0);for(let d=0;d<=e;++d)v.add(p[d].multiplyScalar(c[d]));v.divideScalar(v.w),o.set(v.x,v.y,v.z)}class cn extends h.Curve{constructor(e,t,n,r,a){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=a||this.knots.length-1;for(let s=0;s<n.length;++s){const o=n[s];this.controlPoints[s]=new h.Vector4(o.x,o.y,o.z,o.w)}}getPoint(e,t=new h.Vector3){const n=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=nn(this.degree,this.knots,this.controlPoints,r);return a.w!==1&&a.divideScalar(a.w),n.set(a.x,a.y,a.z)}getTangent(e,t=new h.Vector3){const n=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=ln(this.degree,this.knots,this.controlPoints,r,1);return n.copy(a[1]).normalize(),n}}let M,X,q;class fn extends h.Loader{constructor(e){super(e)}load(e,t,n,r){const a=this,s=a.path===""?h.LoaderUtils.extractUrlBase(e):a.path,o=new h.FileLoader(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(l){try{t(a.parse(l,s))}catch(f){r?r(f):console.error(f),a.manager.itemError(e)}},n,r)}parse(e,t){if(mn(e))M=new dn().parse(e);else{const r=Ot(e);if(!gn(r))throw new Error("THREE.FBXLoader: Unknown format.");if(Lt(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Lt(r));M=new vn().parse(r)}const n=new h.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new un(n,this.manager).parse(M)}}class un{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){X=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),a=new hn().parse(r);return this.parseScene(r,a,n),q}parseConnections(){const e=new Map;return"Connections"in M&&M.Connections.connections.forEach(function(n){const r=n[0],a=n[1],s=n[2];e.has(r)||e.set(r,{parents:[],children:[]});const o={ID:a,relationship:s};e.get(r).parents.push(o),e.has(a)||e.set(a,{parents:[],children:[]});const l={ID:r,relationship:s};e.get(a).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in M.Objects){const n=M.Objects.Video;for(const r in n){const a=n[r],s=parseInt(r);if(e[s]=a.RelativeFilename||a.Filename,"Content"in a){const o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,l=typeof a.Content=="string"&&a.Content!=="";if(o||l){const f=this.parseImage(n[r]);t[a.RelativeFilename||a.Filename]=f}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let a;switch(r){case"bmp":a="image/bmp";break;case"jpg":case"jpeg":a="image/jpeg";break;case"png":a="image/png";break;case"tif":a="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),a="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+a+";base64,"+t;{const s=new Uint8Array(t);return window.URL.createObjectURL(new Blob([s],{type:a}))}}parseTextures(e){const t=new Map;if("Texture"in M.Objects){const n=M.Objects.Texture;for(const r in n){const a=this.parseTexture(n[r],e);t.set(parseInt(r),a)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,a=e.WrapModeV,s=r!==void 0?r.value:0,o=a!==void 0?a.value:0;if(n.wrapS=s===0?h.RepeatWrapping:h.ClampToEdgeWrapping,n.wrapT=o===0?h.RepeatWrapping:h.ClampToEdgeWrapping,"Scaling"in e){const l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;n.offset.x=l[0],n.offset.y=l[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,a=X.get(e.id).children;a!==void 0&&a.length>0&&t[a[0].ID]!==void 0&&(n=t[a[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let s;const o=e.FileName.slice(-3).toLowerCase();if(o==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new h.Texture):(l.setPath(this.textureLoader.path),s=l.load(n))}else o==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new h.Texture):s=this.textureLoader.load(n);return this.textureLoader.setPath(r),s}parseMaterials(e){const t=new Map;if("Material"in M.Objects){const n=M.Objects.Material;for(const r in n){const a=this.parseMaterial(n[r],e);a!==null&&t.set(parseInt(r),a)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let a=e.ShadingModel;if(typeof a=="object"&&(a=a.value),!X.has(n))return null;const s=this.parseParameters(e,t,n);let o;switch(a.toLowerCase()){case"phong":o=new h.MeshPhongMaterial;break;case"lambert":o=new h.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new h.MeshPhongMaterial;break}return o.setValues(s),o.name=r,o}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new h.Color().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=new h.Color().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new h.Color().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=new h.Color().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new h.Color().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new h.Color().fromArray(e.SpecularColor.value).convertSRGBToLinear());const a=this;return X.get(n).children.forEach(function(s){const o=s.relationship;switch(o){case"Bump":r.bumpMap=a.getTexture(t,s.ID);break;case"Maya|TEX_ao_map":r.aoMap=a.getTexture(t,s.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=a.getTexture(t,s.ID),r.map!==void 0&&(r.map.colorSpace=h.SRGBColorSpace);break;case"DisplacementColor":r.displacementMap=a.getTexture(t,s.ID);break;case"EmissiveColor":r.emissiveMap=a.getTexture(t,s.ID),r.emissiveMap!==void 0&&(r.emissiveMap.colorSpace=h.SRGBColorSpace);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=a.getTexture(t,s.ID);break;case"ReflectionColor":r.envMap=a.getTexture(t,s.ID),r.envMap!==void 0&&(r.envMap.mapping=h.EquirectangularReflectionMapping,r.envMap.colorSpace=h.SRGBColorSpace);break;case"SpecularColor":r.specularMap=a.getTexture(t,s.ID),r.specularMap!==void 0&&(r.specularMap.colorSpace=h.SRGBColorSpace);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=a.getTexture(t,s.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",o);break}}),r}getTexture(e,t){return"LayeredTexture"in M.Objects&&t in M.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=X.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in M.Objects){const n=M.Objects.Deformer;for(const r in n){const a=n[r],s=X.get(parseInt(r));if(a.attrType==="Skin"){const o=this.parseSkeleton(s,n);o.ID=r,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=s.parents[0].ID,e[r]=o}else if(a.attrType==="BlendShape"){const o={id:r};o.rawTargets=this.parseMorphTargets(s,n),o.id=r,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const a=t[r.ID];if(a.attrType!=="Cluster")return;const s={ID:r.ID,indices:[],weights:[],transformLink:new h.Matrix4().fromArray(a.TransformLink.a)};"Indexes"in a&&(s.indices=a.Indexes.a,s.weights=a.Weights.a),n.push(s)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const a=e.children[r],s=t[a.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if(s.attrType!=="BlendShapeChannel")return;o.geoID=X.get(parseInt(a.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(o)}return n}parseScene(e,t,n){q=new h.Group;const r=this.parseModels(e.skeletons,t,n),a=M.Objects.Model,s=this;r.forEach(function(l){const f=a[l.ID];s.setLookAtProperties(l,f),X.get(l.ID).parents.forEach(function(c){const p=r.get(c.ID);p!==void 0&&p.add(l)}),l.parent===null&&q.add(l)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),q.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const f=Ut(l.userData.transformData);l.applyMatrix4(f),l.updateWorldMatrix()}});const o=new pn().parse();q.children.length===1&&q.children[0].isGroup&&(q.children[0].animations=o,q=q.children[0]),q.animations=o}parseModels(e,t,n){const r=new Map,a=M.Objects.Model;for(const s in a){const o=parseInt(s),l=a[s],f=X.get(o);let u=this.buildSkeleton(f,e,o,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(f);break;case"Light":u=this.createLight(f);break;case"Mesh":u=this.createMesh(f,t,n);break;case"NurbsCurve":u=this.createCurve(f,t);break;case"LimbNode":case"Root":u=new h.Bone;break;case"Null":default:u=new h.Group;break}u.name=l.attrName?h.PropertyBinding.sanitizeNodeName(l.attrName):"",u.ID=o}this.getTransformData(u,l),r.set(o,u)}return r}buildSkeleton(e,t,n,r){let a=null;return e.parents.forEach(function(s){for(const o in t){const l=t[o];l.rawBones.forEach(function(f,u){if(f.ID===s.ID){const c=a;a=new h.Bone,a.matrixWorld.copy(f.transformLink),a.name=r?h.PropertyBinding.sanitizeNodeName(r):"",a.ID=n,l.bones[u]=a,c!==null&&a.add(c)}})}}),a}createCamera(e){let t,n;if(e.children.forEach(function(r){const a=M.Objects.NodeAttribute[r.ID];a!==void 0&&(n=a)}),n===void 0)t=new h.Object3D;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let a=1;n.NearPlane!==void 0&&(a=n.NearPlane.value/1e3);let s=1e3;n.FarPlane!==void 0&&(s=n.FarPlane.value/1e3);let o=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(o=n.AspectWidth.value,l=n.AspectHeight.value);const f=o/l;let u=45;n.FieldOfView!==void 0&&(u=n.FieldOfView.value);const c=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new h.PerspectiveCamera(u,f,a,s),c!==null&&t.setFocalLength(c);break;case 1:t=new h.OrthographicCamera(-o/2,o/2,l/2,-l/2,a,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new h.Object3D;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const a=M.Objects.NodeAttribute[r.ID];a!==void 0&&(n=a)}),n===void 0)t=new h.Object3D;else{let r;n.LightType===void 0?r=0:r=n.LightType.value;let a=16777215;n.Color!==void 0&&(a=new h.Color().fromArray(n.Color.value).convertSRGBToLinear());let s=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(s=0);let o=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?o=0:o=n.FarAttenuationEnd.value);const l=1;switch(r){case 0:t=new h.PointLight(a,s,o,l);break;case 1:t=new h.DirectionalLight(a,s);break;case 2:let f=Math.PI/3;n.InnerAngle!==void 0&&(f=h.MathUtils.degToRad(n.InnerAngle.value));let u=0;n.OuterAngle!==void 0&&(u=h.MathUtils.degToRad(n.OuterAngle.value),u=Math.max(u,1)),t=new h.SpotLight(a,s,o,f,u,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new h.PointLight(a,s);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,a=null,s=null;const o=[];return e.children.forEach(function(l){t.has(l.ID)&&(a=t.get(l.ID)),n.has(l.ID)&&o.push(n.get(l.ID))}),o.length>1?s=o:o.length>0?s=o[0]:(s=new h.MeshPhongMaterial({color:13421772}),o.push(s)),"color"in a.attributes&&o.forEach(function(l){l.vertexColors=!0}),a.FBX_Deformer?(r=new h.SkinnedMesh(a,s),r.normalizeSkinWeights()):r=new h.Mesh(a,s),r}createCurve(e,t){const n=e.children.reduce(function(a,s){return t.has(s.ID)&&(a=t.get(s.ID)),a},null),r=new h.LineBasicMaterial({color:3342591,linewidth:1});return new h.Line(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Bt(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&X.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const a=M.Objects.Model[r.ID];if("Lcl_Translation"in a){const s=a.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(s),q.add(e.target)):e.lookAt(new h.Vector3().fromArray(s))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const a in e){const s=e[a];X.get(parseInt(s.ID)).parents.forEach(function(l){if(t.has(l.ID)){const f=l.ID;X.get(f).parents.forEach(function(c){n.has(c.ID)&&n.get(c.ID).bind(new h.Skeleton(s.bones),r[c.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in M.Objects){const t=M.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(a){e[a.Node]=new h.Matrix4().fromArray(a.Matrix.a)}):e[r.Node]=new h.Matrix4().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in M&&"AmbientColor"in M.GlobalSettings){const e=M.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const a=new h.Color(t,n,r).convertSRGBToLinear();q.add(new h.AmbientLight(a,1))}}}}class hn{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in M.Objects){const n=M.Objects.Geometry;for(const r in n){const a=X.get(parseInt(r)),s=this.parseGeometry(a,n[r],e);t.set(parseInt(r),s)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,a=[],s=e.parents.map(function(c){return M.Objects.Model[c.ID]});if(s.length===0)return;const o=e.children.reduce(function(c,p){return r[p.ID]!==void 0&&(c=r[p.ID]),c},null);e.children.forEach(function(c){n.morphTargets[c.ID]!==void 0&&a.push(n.morphTargets[c.ID])});const l=s[0],f={};"RotationOrder"in l&&(f.eulerOrder=Bt(l.RotationOrder.value)),"InheritType"in l&&(f.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(f.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(f.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(f.scale=l.GeometricScaling.value);const u=Ut(f);return this.genGeometry(t,o,a,u)}genGeometry(e,t,n,r){const a=new h.BufferGeometry;e.attrName&&(a.name=e.attrName);const s=this.parseGeoNode(e,t),o=this.genBuffers(s),l=new h.Float32BufferAttribute(o.vertex,3);if(l.applyMatrix4(r),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new h.Float32BufferAttribute(o.colors,3)),t&&(a.setAttribute("skinIndex",new h.Uint16BufferAttribute(o.weightsIndices,4)),a.setAttribute("skinWeight",new h.Float32BufferAttribute(o.vertexWeights,4)),a.FBX_Deformer=t),o.normal.length>0){const f=new h.Matrix3().getNormalMatrix(r),u=new h.Float32BufferAttribute(o.normal,3);u.applyNormalMatrix(f),a.setAttribute("normal",u)}if(o.uvs.forEach(function(f,u){const c=u===0?"uv":`uv${u}`;a.setAttribute(c,new h.Float32BufferAttribute(o.uvs[u],2))}),s.material&&s.material.mappingType!=="AllSame"){let f=o.materialIndex[0],u=0;if(o.materialIndex.forEach(function(c,p){c!==f&&(a.addGroup(u,p-u,f),f=c,u=p)}),a.groups.length>0){const c=a.groups[a.groups.length-1],p=c.start+c.count;p!==o.materialIndex.length&&a.addGroup(p,o.materialIndex.length-p,f)}a.groups.length===0&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,e,n,r),a}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,a){r.indices.forEach(function(s,o){n.weightTable[s]===void 0&&(n.weightTable[s]=[]),n.weightTable[s].push({id:a,weight:r.weights[o]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,a=!1,s=[],o=[],l=[],f=[],u=[],c=[];const p=this;return e.vertexIndices.forEach(function(v,d){let m,x=!1;v<0&&(v=v^-1,x=!0);let _=[],T=[];if(s.push(v*3,v*3+1,v*3+2),e.color){const y=Qe(d,n,v,e.color);l.push(y[0],y[1],y[2])}if(e.skeleton){if(e.weightTable[v]!==void 0&&e.weightTable[v].forEach(function(y){T.push(y.weight),_.push(y.id)}),T.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);const y=[0,0,0,0],k=[0,0,0,0];T.forEach(function(E,S){let A=E,D=_[S];k.forEach(function(H,F,ee){if(A>H){ee[F]=A,A=H;const U=y[F];y[F]=D,D=U}})}),_=y,T=k}for(;T.length<4;)T.push(0),_.push(0);for(let y=0;y<4;++y)u.push(T[y]),c.push(_[y])}if(e.normal){const y=Qe(d,n,v,e.normal);o.push(y[0],y[1],y[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=Qe(d,n,v,e.material)[0],m<0&&(p.negativeMaterialIndices=!0,m=0)),e.uv&&e.uv.forEach(function(y,k){const E=Qe(d,n,v,y);f[k]===void 0&&(f[k]=[]),f[k].push(E[0]),f[k].push(E[1])}),r++,x&&(r>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),p.genFace(t,e,s,m,o,l,f,u,c,r),n++,r=0,s=[],o=[],l=[],f=[],u=[],c=[])}),t}genFace(e,t,n,r,a,s,o,l,f,u){for(let c=2;c<u;c++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(c-1)*3]]),e.vertex.push(t.vertexPositions[n[(c-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(c-1)*3+2]]),e.vertex.push(t.vertexPositions[n[c*3]]),e.vertex.push(t.vertexPositions[n[c*3+1]]),e.vertex.push(t.vertexPositions[n[c*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(c-1)*4]),e.vertexWeights.push(l[(c-1)*4+1]),e.vertexWeights.push(l[(c-1)*4+2]),e.vertexWeights.push(l[(c-1)*4+3]),e.vertexWeights.push(l[c*4]),e.vertexWeights.push(l[c*4+1]),e.vertexWeights.push(l[c*4+2]),e.vertexWeights.push(l[c*4+3]),e.weightsIndices.push(f[0]),e.weightsIndices.push(f[1]),e.weightsIndices.push(f[2]),e.weightsIndices.push(f[3]),e.weightsIndices.push(f[(c-1)*4]),e.weightsIndices.push(f[(c-1)*4+1]),e.weightsIndices.push(f[(c-1)*4+2]),e.weightsIndices.push(f[(c-1)*4+3]),e.weightsIndices.push(f[c*4]),e.weightsIndices.push(f[c*4+1]),e.weightsIndices.push(f[c*4+2]),e.weightsIndices.push(f[c*4+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[(c-1)*3]),e.colors.push(s[(c-1)*3+1]),e.colors.push(s[(c-1)*3+2]),e.colors.push(s[c*3]),e.colors.push(s[c*3+1]),e.colors.push(s[c*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(a[0]),e.normal.push(a[1]),e.normal.push(a[2]),e.normal.push(a[(c-1)*3]),e.normal.push(a[(c-1)*3+1]),e.normal.push(a[(c-1)*3+2]),e.normal.push(a[c*3]),e.normal.push(a[c*3+1]),e.normal.push(a[c*3+2])),t.uv&&t.uv.forEach(function(p,v){e.uvs[v]===void 0&&(e.uvs[v]=[]),e.uvs[v].push(o[v][0]),e.uvs[v].push(o[v][1]),e.uvs[v].push(o[v][(c-1)*2]),e.uvs[v].push(o[v][(c-1)*2+1]),e.uvs[v].push(o[v][c*2]),e.uvs[v].push(o[v][c*2+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const a=this;n.forEach(function(s){s.rawTargets.forEach(function(o){const l=M.Objects.Geometry[o.geoID];l!==void 0&&a.genMorphGeometry(e,t,l,r,o.name)})})}genMorphGeometry(e,t,n,r,a){const s=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],o=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],f=e.attributes.position.count*3,u=new Float32Array(f);for(let d=0;d<l.length;d++){const m=l[d]*3;u[m]=o[d*3],u[m+1]=o[d*3+1],u[m+2]=o[d*3+2]}const c={vertexIndices:s,vertexPositions:u},p=this.genBuffers(c),v=new h.Float32BufferAttribute(p.vertex,3);v.name=a||n.attrName,v.applyMatrix4(r),e.morphAttributes.position.push(v)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let a=[];return n==="IndexToDirect"&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:a,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let a=[];return n==="IndexToDirect"&&(a=e.UVIndex.a),{dataSize:2,buffer:r,indices:a,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let a=[];n==="IndexToDirect"&&(a=e.ColorIndex.a);for(let s=0,o=new h.Color;s<r.length;s+=4)o.fromArray(r,s).convertSRGBToLinear().toArray(r,s);return{dataSize:4,buffer:r,indices:a,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,a=[];for(let s=0;s<r.length;++s)a.push(s);return{dataSize:1,buffer:r,indices:a,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new h.BufferGeometry;const n=t-1,r=e.KnotVector.a,a=[],s=e.Points.a;for(let c=0,p=s.length;c<p;c+=4)a.push(new h.Vector4().fromArray(s,c));let o,l;if(e.Form==="Closed")a.push(a[0]);else if(e.Form==="Periodic"){o=n,l=r.length-1-o;for(let c=0;c<n;++c)a.push(a[c])}const u=new cn(n,r,a,o,l).getPoints(a.length*12);return new h.BufferGeometry().setFromPoints(u)}}class pn{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],a=this.addClip(r);e.push(a)}return e}parseClips(){if(M.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=M.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const a={id:r.id,attr:r.attrName,curves:{}};t.set(a.id,a)}}return t}parseAnimationCurves(e){const t=M.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(yn),values:t[n].KeyValueFloat.a},a=X.get(r.id);if(a!==void 0){const s=a.parents[0].ID,o=a.parents[0].relationship;o.match(/X/)?e.get(s).curves.x=r:o.match(/Y/)?e.get(s).curves.y=r:o.match(/Z/)?e.get(s).curves.z=r:o.match(/DeformPercent/)&&e.has(s)&&(e.get(s).curves.morph=r)}}}parseAnimationLayers(e){const t=M.Objects.AnimationLayer,n=new Map;for(const r in t){const a=[],s=X.get(parseInt(r));s!==void 0&&(s.children.forEach(function(l,f){if(e.has(l.ID)){const u=e.get(l.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(a[f]===void 0){const c=X.get(l.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(c!==void 0){const p=M.Objects.Model[c.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const v={modelName:p.attrName?h.PropertyBinding.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};q.traverse(function(d){d.ID===p.id&&(v.transform=d.matrix,d.userData.transformData&&(v.eulerOrder=d.userData.transformData.eulerOrder))}),v.transform||(v.transform=new h.Matrix4),"PreRotation"in p&&(v.preRotation=p.PreRotation.value),"PostRotation"in p&&(v.postRotation=p.PostRotation.value),a[f]=v}}a[f]&&(a[f][u.attr]=u)}else if(u.curves.morph!==void 0){if(a[f]===void 0){const c=X.get(l.ID).parents.filter(function(_){return _.relationship!==void 0})[0].ID,p=X.get(c).parents[0].ID,v=X.get(p).parents[0].ID,d=X.get(v).parents[0].ID,m=M.Objects.Model[d],x={modelName:m.attrName?h.PropertyBinding.sanitizeNodeName(m.attrName):"",morphName:M.Objects.Deformer[c].attrName};a[f]=x}a[f][u.attr]=u}}}),n.set(parseInt(r),a))}return n}parseAnimStacks(e){const t=M.Objects.AnimationStack,n={};for(const r in t){const a=X.get(parseInt(r)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(a[0].ID);n[r]={name:t[r].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new h.AnimationClip(e.name,-1,t)}generateTracks(e){const t=[];let n=new h.Vector3,r=new h.Quaternion,a=new h.Vector3;if(e.transform&&e.transform.decompose(n,r,a),n=n.toArray(),r=new h.Euler().setFromQuaternion(r,e.eulerOrder).toArray(),a=a.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");s!==void 0&&t.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&t.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");s!==void 0&&t.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&t.push(s)}return t}generateVectorTrack(e,t,n,r){const a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,n);return new h.VectorKeyframeTrack(e+"."+r,a,s)}generateRotationTrack(e,t,n,r,a,s){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(h.MathUtils.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(h.MathUtils.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(h.MathUtils.degToRad));const o=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(o,t,n);r!==void 0&&(r=r.map(h.MathUtils.degToRad),r.push(s),r=new h.Euler().fromArray(r),r=new h.Quaternion().setFromEuler(r)),a!==void 0&&(a=a.map(h.MathUtils.degToRad),a.push(s),a=new h.Euler().fromArray(a),a=new h.Quaternion().setFromEuler(a).invert());const f=new h.Quaternion,u=new h.Euler,c=[];for(let p=0;p<l.length;p+=3)u.set(l[p],l[p+1],l[p+2],s),f.setFromEuler(u),r!==void 0&&f.premultiply(r),a!==void 0&&f.multiply(a),f.toArray(c,p/3*4);return new h.QuaternionKeyframeTrack(e+".quaternion",o,c)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(a){return a/100}),r=q.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new h.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let a=1;a<t.length;a++){const s=t[a];s!==r&&(t[n]=s,r=s,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,a=[];let s=-1,o=-1,l=-1;return e.forEach(function(f){if(t.x&&(s=t.x.times.indexOf(f)),t.y&&(o=t.y.times.indexOf(f)),t.z&&(l=t.z.times.indexOf(f)),s!==-1){const u=t.x.values[s];a.push(u),r[0]=u}else a.push(r[0]);if(o!==-1){const u=t.y.values[o];a.push(u),r[1]=u}else a.push(r[1]);if(l!==-1){const u=t.z.values[l];a.push(u),r[2]=u}else a.push(r[2])}),a}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,a=Math.abs(r);if(a>=180){const s=a/180,o=r/s;let l=n+o;const f=e.times[t-1],c=(e.times[t]-f)/s;let p=f+c;const v=[],d=[];for(;p<e.times[t];)v.push(p),p+=c,d.push(l),l+=o;e.times=Gt(e.times,t,v),e.values=Gt(e.values,t,d)}}}}class vn{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new zt,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,a){const s=r.match(/^[\s\t]*;/),o=r.match(/^[\s\t]*$/);if(s||o)return;const l=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),f=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=r.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(r,l):f?t.parseNodeProperty(r,f,n[++a]):u?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:n},s=this.parseNodeAttr(r),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,a):n in o?(n==="PoseNode"?o.PoseNode.push(a):o[n].id!==void 0&&(o[n]={},o[n][o[n].id]=o[n]),s.id!==""&&(o[n][s.id]=a)):typeof s.id=="number"?(o[n]={},o[n][s.id]=a):n!=="Properties70"&&(n==="PoseNode"?o[n]=[a]:o[n]=a),typeof s.id=="number"&&(a.id=s.id),s.name!==""&&(a.attrName=s.name),s.type!==""&&(a.attrType=s.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&a===","&&(a=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if(s.name==="Properties70"){this.parseNodeSpecialProperty(e,r,a);return}if(r==="C"){const l=a.split(",").slice(1),f=parseInt(l[0]),u=parseInt(l[1]);let c=a.split(",").slice(3);c=c.map(function(p){return p.trim().replace(/^"/,"")}),r="connections",a=[f,u],xn(a,c),s[r]===void 0&&(s[r]=[])}r==="Node"&&(s.id=a),r in s&&Array.isArray(s[r])?s[r].push(a):r!=="a"?s[r]=a:s.a=a,this.setCurrentProp(s,r),r==="a"&&a.slice(-1)!==","&&(s.a=lt(a))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=lt(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=r[0],s=r[1],o=r[2],l=r[3];let f=r[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":f=parseFloat(f);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":f=lt(f);break}this.getPrevNode()[a]={type:s,type2:o,flag:l,value:f},this.setCurrentProp(this.getPrevNode(),a)}}class dn{parse(e){const t=new Rt(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new zt;for(;!this.endOfContent(t);){const a=this.parseNode(t,n);a!==null&&r.add(a.name,a)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),o=e.getString(s);if(r===0)return null;const l=[];for(let p=0;p<a;p++)l.push(this.parseProperty(e));const f=l.length>0?l[0]:"",u=l.length>1?l[1]:"",c=l.length>2?l[2]:"";for(n.singleProperty=a===1&&e.getOffset()===r;r>e.getOffset();){const p=this.parseNode(e,t);p!==null&&this.parseSubNode(o,n,p)}return n.propertyList=l,typeof f=="number"&&(n.id=f),u!==""&&(n.attrName=u),c!==""&&(n.attrType=c),o!==""&&(n.name=o),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(a,s){s!==0&&r.push(a)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(a){t[a]=n[a]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],a=n.propertyList[1];const s=n.propertyList[2],o=n.propertyList[3];let l;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),a==="Color"||a==="ColorRGB"||a==="Vector"||a==="Vector3D"||a.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[r]={type:a,type2:s,flag:o,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),a=e.getUint32(),s=e.getUint32();if(a===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const o=Xe(new Uint8Array(e.getArrayBuffer(s))),l=new Rt(o.buffer);switch(t){case"b":case"c":return l.getBooleanArray(r);case"d":return l.getFloat64Array(r);case"f":return l.getFloat32Array(r);case"i":return l.getInt32Array(r);case"l":return l.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Rt{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const r=n.indexOf(0);return r>=0&&(n=new Uint8Array(this.dv.buffer,t,r)),this._textDecoder.decode(n)}}class zt{add(e,t){this[e]=t}}function mn(i){const e="Kaydara FBX Binary  \0";return i.byteLength>=e.length&&e===Ot(i,0,e.length)}function gn(i){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(r){const a=i[r-1];return i=i.slice(t+r),t++,a}for(let r=0;r<e.length;++r)if(n(1)===e[r])return!1;return!0}function Lt(i){const e=/FBXVersion: (\d+)/,t=i.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function yn(i){return i/46186158e3}const wn=[];function Qe(i,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=i;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const a=r*n.dataSize,s=a+n.dataSize;return Dn(wn,n.buffer,a,s)}const ot=new h.Euler,Te=new h.Vector3;function Ut(i){const e=new h.Matrix4,t=new h.Matrix4,n=new h.Matrix4,r=new h.Matrix4,a=new h.Matrix4,s=new h.Matrix4,o=new h.Matrix4,l=new h.Matrix4,f=new h.Matrix4,u=new h.Matrix4,c=new h.Matrix4,p=new h.Matrix4,v=i.inheritType?i.inheritType:0;if(i.translation&&e.setPosition(Te.fromArray(i.translation)),i.preRotation){const F=i.preRotation.map(h.MathUtils.degToRad);F.push(i.eulerOrder||h.Euler.DEFAULT_ORDER),t.makeRotationFromEuler(ot.fromArray(F))}if(i.rotation){const F=i.rotation.map(h.MathUtils.degToRad);F.push(i.eulerOrder||h.Euler.DEFAULT_ORDER),n.makeRotationFromEuler(ot.fromArray(F))}if(i.postRotation){const F=i.postRotation.map(h.MathUtils.degToRad);F.push(i.eulerOrder||h.Euler.DEFAULT_ORDER),r.makeRotationFromEuler(ot.fromArray(F)),r.invert()}i.scale&&a.scale(Te.fromArray(i.scale)),i.scalingOffset&&o.setPosition(Te.fromArray(i.scalingOffset)),i.scalingPivot&&s.setPosition(Te.fromArray(i.scalingPivot)),i.rotationOffset&&l.setPosition(Te.fromArray(i.rotationOffset)),i.rotationPivot&&f.setPosition(Te.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(c.copy(i.parentMatrix),u.copy(i.parentMatrixWorld));const d=t.clone().multiply(n).multiply(r),m=new h.Matrix4;m.extractRotation(u);const x=new h.Matrix4;x.copyPosition(u);const _=x.clone().invert().multiply(u),T=m.clone().invert().multiply(_),y=a,k=new h.Matrix4;if(v===0)k.copy(m).multiply(d).multiply(T).multiply(y);else if(v===1)k.copy(m).multiply(T).multiply(d).multiply(y);else{const ee=new h.Matrix4().scale(new h.Vector3().setFromMatrixScale(c)).clone().invert(),U=T.clone().multiply(ee);k.copy(m).multiply(d).multiply(U).multiply(y)}const E=f.clone().invert(),S=s.clone().invert();let A=e.clone().multiply(l).multiply(f).multiply(t).multiply(n).multiply(r).multiply(E).multiply(o).multiply(s).multiply(a).multiply(S);const D=new h.Matrix4().copyPosition(A),H=u.clone().multiply(D);return p.copyPosition(H),A=p.clone().multiply(k),A.premultiply(u.invert()),A}function Bt(i){i=i||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return i===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[i]}function lt(i){return i.split(",").map(function(t){return parseFloat(t)})}function Ot(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=i.byteLength),new TextDecoder().decode(new Uint8Array(i,e,t))}function xn(i,e){for(let t=0,n=i.length,r=e.length;t<r;t++,n++)i[n]=e[t]}function Dn(i,e,t,n){for(let r=t,a=0;r<n;r++,a++)i[a]=e[r];return i}function Gt(i,e,t){return i.slice(0,e).concat(t).concat(i.slice(e))}},89079:function(Ce,oe,j){j.d(oe,{A:function(){return ae}});var h=j(99477),J=j(78304);const Y={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		varying vec2 vUv;

		uniform sampler2D tColor;
		uniform sampler2D tDepth;

		uniform float maxblur; // max blur amount
		uniform float aperture; // aperture - bigger values for shallower depth of field

		uniform float nearClip;
		uniform float farClip;

		uniform float focus;
		uniform float aspect;

		#include <packing>

		float getDepth( const in vec2 screenPosition ) {
			#if DEPTH_PACKING == 1
			return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );
			#else
			return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, nearClip, farClip );
			#else
			return orthographicDepthToViewZ( depth, nearClip, farClip );
			#endif
		}


		void main() {

			vec2 aspectcorrect = vec2( 1.0, aspect );

			float viewZ = getViewZ( getDepth( vUv ) );

			float factor = ( focus + viewZ ); // viewZ is <= 0, so this is a difference equation

			vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );

			vec2 dofblur9 = dofblur * 0.9;
			vec2 dofblur7 = dofblur * 0.7;
			vec2 dofblur4 = dofblur * 0.4;

			vec4 col = vec4( 0.0 );

			col += texture2D( tColor, vUv.xy );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );

			col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );

			col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );

			col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );

			gl_FragColor = col / 41.0;
			gl_FragColor.a = 1.0;

		}`};class ae extends J.w{constructor(w,b,P){super(),this.scene=w,this.camera=b;const g=P.focus!==void 0?P.focus:1,C=P.aspect!==void 0?P.aspect:b.aspect,B=P.aperture!==void 0?P.aperture:.025,V=P.maxblur!==void 0?P.maxblur:1;this.renderTargetDepth=new h.WebGLRenderTarget(1,1,{minFilter:h.NearestFilter,magFilter:h.NearestFilter}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new h.MeshDepthMaterial,this.materialDepth.depthPacking=h.RGBADepthPacking,this.materialDepth.blending=h.NoBlending;const R=Y,L=h.UniformsUtils.clone(R.uniforms);L.tDepth.value=this.renderTargetDepth.texture,L.focus.value=g,L.aspect.value=C,L.aperture.value=B,L.maxblur.value=V,L.nearClip.value=b.near,L.farClip.value=b.far,this.materialBokeh=new h.ShaderMaterial({defines:Object.assign({},R.defines),uniforms:L,vertexShader:R.vertexShader,fragmentShader:R.fragmentShader}),this.uniforms=L,this.needsSwap=!1,this.fsQuad=new J.T(this.materialBokeh),this._oldClearColor=new h.Color}render(w,b,P){this.scene.overrideMaterial=this.materialDepth,w.getClearColor(this._oldClearColor);const g=w.getClearAlpha(),C=w.autoClear;w.autoClear=!1,w.setClearColor(16777215),w.setClearAlpha(1),w.setRenderTarget(this.renderTargetDepth),w.clear(),w.render(this.scene,this.camera),this.uniforms.tColor.value=P.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(w.setRenderTarget(null),this.fsQuad.render(w)):(w.setRenderTarget(b),w.clear(),this.fsQuad.render(w)),this.scene.overrideMaterial=null,w.setClearColor(this._oldClearColor),w.setClearAlpha(g),w.autoClear=C}setSize(w,b){this.renderTargetDepth.setSize(w,b)}dispose(){this.renderTargetDepth.dispose(),this.materialDepth.dispose(),this.materialBokeh.dispose(),this.fsQuad.dispose()}}},97809:function(Ce,oe,j){j.d(oe,{x:function(){return b}});var h=j(99477);const J={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};var Y=j(78304);class ae extends Y.w{constructor(g,C){super(),this.textureID=C!==void 0?C:"tDiffuse",g instanceof h.ShaderMaterial?(this.uniforms=g.uniforms,this.material=g):g&&(this.uniforms=h.UniformsUtils.clone(g.uniforms),this.material=new h.ShaderMaterial({defines:Object.assign({},g.defines),uniforms:this.uniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader})),this.fsQuad=new Y.T(this.material)}render(g,C,B){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=B.texture),this.fsQuad.material=this.material,this.renderToScreen?(g.setRenderTarget(null),this.fsQuad.render(g)):(g.setRenderTarget(C),this.clear&&g.clear(g.autoClearColor,g.autoClearDepth,g.autoClearStencil),this.fsQuad.render(g))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class I extends Y.w{constructor(g,C){super(),this.scene=g,this.camera=C,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(g,C,B){const V=g.getContext(),R=g.state;R.buffers.color.setMask(!1),R.buffers.depth.setMask(!1),R.buffers.color.setLocked(!0),R.buffers.depth.setLocked(!0);let L,le;this.inverse?(L=0,le=1):(L=1,le=0),R.buffers.stencil.setTest(!0),R.buffers.stencil.setOp(V.REPLACE,V.REPLACE,V.REPLACE),R.buffers.stencil.setFunc(V.ALWAYS,L,4294967295),R.buffers.stencil.setClear(le),R.buffers.stencil.setLocked(!0),g.setRenderTarget(B),this.clear&&g.clear(),g.render(this.scene,this.camera),g.setRenderTarget(C),this.clear&&g.clear(),g.render(this.scene,this.camera),R.buffers.color.setLocked(!1),R.buffers.depth.setLocked(!1),R.buffers.stencil.setLocked(!1),R.buffers.stencil.setFunc(V.EQUAL,1,4294967295),R.buffers.stencil.setOp(V.KEEP,V.KEEP,V.KEEP),R.buffers.stencil.setLocked(!0)}}class w extends Y.w{constructor(){super(),this.needsSwap=!1}render(g){g.state.buffers.stencil.setLocked(!1),g.state.buffers.stencil.setTest(!1)}}class b{constructor(g,C){if(this.renderer=g,this._pixelRatio=g.getPixelRatio(),C===void 0){const B=g.getSize(new h.Vector2);this._width=B.width,this._height=B.height,C=new h.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio),C.texture.name="EffectComposer.rt1"}else this._width=C.width,this._height=C.height;this.renderTarget1=C,this.renderTarget2=C.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ae(J),this.clock=new h.Clock}swapBuffers(){const g=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=g}addPass(g){this.passes.push(g),g.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(g,C){this.passes.splice(C,0,g),g.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(g){const C=this.passes.indexOf(g);C!==-1&&this.passes.splice(C,1)}isLastEnabledPass(g){for(let C=g+1;C<this.passes.length;C++)if(this.passes[C].enabled)return!1;return!0}render(g){g===void 0&&(g=this.clock.getDelta());const C=this.renderer.getRenderTarget();let B=!1;for(let V=0,R=this.passes.length;V<R;V++){const L=this.passes[V];if(L.enabled!==!1){if(L.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(V),L.render(this.renderer,this.writeBuffer,this.readBuffer,g,B),L.needsSwap){if(B){const le=this.renderer.getContext(),_e=this.renderer.state.buffers.stencil;_e.setFunc(le.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,g),_e.setFunc(le.EQUAL,1,4294967295)}this.swapBuffers()}I!==void 0&&(L instanceof I?B=!0:L instanceof w&&(B=!1))}}this.renderer.setRenderTarget(C)}reset(g){if(g===void 0){const C=this.renderer.getSize(new h.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=C.width,this._height=C.height,g=this.renderTarget1.clone(),g.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=g,this.renderTarget2=g.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(g,C){this._width=g,this._height=C;const B=this._width*this._pixelRatio,V=this._height*this._pixelRatio;this.renderTarget1.setSize(B,V),this.renderTarget2.setSize(B,V);for(let R=0;R<this.passes.length;R++)this.passes[R].setSize(B,V)}setPixelRatio(g){this._pixelRatio=g,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}},78304:function(Ce,oe,j){j.d(oe,{T:function(){return I},w:function(){return J}});var h=j(99477);class J{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Y=new h.OrthographicCamera(-1,1,1,-1,0,1),ae=new h.BufferGeometry;ae.setAttribute("position",new h.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),ae.setAttribute("uv",new h.Float32BufferAttribute([0,2,0,0,2,0],2));class I{constructor(b){this._mesh=new h.Mesh(ae,b)}dispose(){this._mesh.geometry.dispose()}render(b){b.render(this._mesh,Y)}get material(){return this._mesh.material}set material(b){this._mesh.material=b}}},54458:function(Ce,oe,j){j.d(oe,{C:function(){return Y}});var h=j(99477),J=j(78304);class Y extends J.w{constructor(I,w,b,P,g){super(),this.scene=I,this.camera=w,this.overrideMaterial=b,this.clearColor=P,this.clearAlpha=g!==void 0?g:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new h.Color}render(I,w,b){const P=I.autoClear;I.autoClear=!1;let g,C;this.overrideMaterial!==void 0&&(C=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(I.getClearColor(this._oldClearColor),g=I.getClearAlpha(),I.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&I.clearDepth(),I.setRenderTarget(this.renderToScreen?null:b),this.clear&&I.clear(I.autoClearColor,I.autoClearDepth,I.autoClearStencil),I.render(this.scene,this.camera),this.clearColor&&I.setClearColor(this._oldClearColor,g),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=C),I.autoClear=P}}},27242:function(Ce,oe,j){j.d(oe,{q:function(){return Y}});var h=j(99477),J=j(78304);class Y extends J.w{constructor(I,w,b,P={}){super(),this.pixelSize=I,this.resolution=new h.Vector2,this.renderResolution=new h.Vector2,this.pixelatedMaterial=this.createPixelatedMaterial(),this.normalMaterial=new h.MeshNormalMaterial,this.fsQuad=new J.T(this.pixelatedMaterial),this.scene=w,this.camera=b,this.normalEdgeStrength=P.normalEdgeStrength||.3,this.depthEdgeStrength=P.depthEdgeStrength||.4,this.beautyRenderTarget=new h.WebGLRenderTarget,this.beautyRenderTarget.texture.minFilter=h.NearestFilter,this.beautyRenderTarget.texture.magFilter=h.NearestFilter,this.beautyRenderTarget.depthTexture=new h.DepthTexture,this.normalRenderTarget=new h.WebGLRenderTarget,this.normalRenderTarget.texture.minFilter=h.NearestFilter,this.normalRenderTarget.texture.magFilter=h.NearestFilter}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.pixelatedMaterial.dispose(),this.normalMaterial.dispose(),this.fsQuad.dispose()}setSize(I,w){this.resolution.set(I,w),this.renderResolution.set(I/this.pixelSize|0,w/this.pixelSize|0);const{x:b,y:P}=this.renderResolution;this.beautyRenderTarget.setSize(b,P),this.normalRenderTarget.setSize(b,P),this.fsQuad.material.uniforms.resolution.value.set(b,P,1/b,1/P)}setPixelSize(I){this.pixelSize=I,this.setSize(this.resolution.x,this.resolution.y)}render(I,w){const b=this.fsQuad.material.uniforms;b.normalEdgeStrength.value=this.normalEdgeStrength,b.depthEdgeStrength.value=this.depthEdgeStrength,I.setRenderTarget(this.beautyRenderTarget),I.render(this.scene,this.camera);const P=this.scene.overrideMaterial;I.setRenderTarget(this.normalRenderTarget),this.scene.overrideMaterial=this.normalMaterial,I.render(this.scene,this.camera),this.scene.overrideMaterial=P,b.tDiffuse.value=this.beautyRenderTarget.texture,b.tDepth.value=this.beautyRenderTarget.depthTexture,b.tNormal.value=this.normalRenderTarget.texture,this.renderToScreen?I.setRenderTarget(null):(I.setRenderTarget(w),this.clear&&I.clear()),this.fsQuad.render(I)}createPixelatedMaterial(){return new h.ShaderMaterial({uniforms:{tDiffuse:{value:null},tDepth:{value:null},tNormal:{value:null},resolution:{value:new h.Vector4(this.renderResolution.x,this.renderResolution.y,1/this.renderResolution.x,1/this.renderResolution.y)},normalEdgeStrength:{value:0},depthEdgeStrength:{value:0}},vertexShader:`
				varying vec2 vUv;

				void main() {

					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}
			`,fragmentShader:`
				uniform sampler2D tDiffuse;
				uniform sampler2D tDepth;
				uniform sampler2D tNormal;
				uniform vec4 resolution;
				uniform float normalEdgeStrength;
				uniform float depthEdgeStrength;
				varying vec2 vUv;

				float getDepth(int x, int y) {

					return texture2D( tDepth, vUv + vec2(x, y) * resolution.zw ).r;

				}

				vec3 getNormal(int x, int y) {

					return texture2D( tNormal, vUv + vec2(x, y) * resolution.zw ).rgb * 2.0 - 1.0;

				}

				float depthEdgeIndicator(float depth, vec3 normal) {

					float diff = 0.0;
					diff += clamp(getDepth(1, 0) - depth, 0.0, 1.0);
					diff += clamp(getDepth(-1, 0) - depth, 0.0, 1.0);
					diff += clamp(getDepth(0, 1) - depth, 0.0, 1.0);
					diff += clamp(getDepth(0, -1) - depth, 0.0, 1.0);
					return floor(smoothstep(0.01, 0.02, diff) * 2.) / 2.;

				}

				float neighborNormalEdgeIndicator(int x, int y, float depth, vec3 normal) {

					float depthDiff = getDepth(x, y) - depth;
					vec3 neighborNormal = getNormal(x, y);

					// Edge pixels should yield to faces who's normals are closer to the bias normal.
					vec3 normalEdgeBias = vec3(1., 1., 1.); // This should probably be a parameter.
					float normalDiff = dot(normal - neighborNormal, normalEdgeBias);
					float normalIndicator = clamp(smoothstep(-.01, .01, normalDiff), 0.0, 1.0);

					// Only the shallower pixel should detect the normal edge.
					float depthIndicator = clamp(sign(depthDiff * .25 + .0025), 0.0, 1.0);

					return (1.0 - dot(normal, neighborNormal)) * depthIndicator * normalIndicator;

				}

				float normalEdgeIndicator(float depth, vec3 normal) {

					float indicator = 0.0;

					indicator += neighborNormalEdgeIndicator(0, -1, depth, normal);
					indicator += neighborNormalEdgeIndicator(0, 1, depth, normal);
					indicator += neighborNormalEdgeIndicator(-1, 0, depth, normal);
					indicator += neighborNormalEdgeIndicator(1, 0, depth, normal);

					return step(0.1, indicator);

				}

				void main() {

					vec4 texel = texture2D( tDiffuse, vUv );

					float depth = 0.0;
					vec3 normal = vec3(0.0);

					if (depthEdgeStrength > 0.0 || normalEdgeStrength > 0.0) {

						depth = getDepth(0, 0);
						normal = getNormal(0, 0);

					}

					float dei = 0.0;
					if (depthEdgeStrength > 0.0)
						dei = depthEdgeIndicator(depth, normal);

					float nei = 0.0;
					if (normalEdgeStrength > 0.0)
						nei = normalEdgeIndicator(depth, normal);

					float Strength = dei > 0.0 ? (1.0 - depthEdgeStrength * dei) : (1.0 + normalEdgeStrength * nei);

					gl_FragColor = texel * Strength;

				}
			`})}}}}]);
